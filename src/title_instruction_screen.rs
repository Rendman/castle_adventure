use bevy::prelude::*;
use bevy_ascii_terminal::{Terminal, TileFormatter};

use crate::FORE_COLOR;

use super::GameState;

const TITLE_SCREEN: [char; 1000] = [
' ',' ',' ','P',' ','-',' ','t','o',' ','p','l','a','y',' ',' ',' ','I',' ','-',' ','f','o','r',' ','i','n','s','t','r','u','c','t','i','o','n','s',' ',' ',' ',
' ','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─','─',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','█','┼','┼','┼','█','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','█','┼','┼','┼','█','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','█','┼','┼','┼','█','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','█','┼','┼','┼','█','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','█','█','█','█','█','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ','▓','▓','▓','▓','▓',' ','▄','▄',' ','▄','▄',' ','▄','▄',' ','▄','▄',' ','▄','▄',' ','▄','▄',' ','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','▓','▓','▓','▓','▓','▓','▓',' ',' ',' ',' ',' ',
' ',' ',' ',' ','█',' ','█',' ','█',' ','█',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','█',' ','█',' ','█',' ','█',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ','C','a','s','t','l','e',' ','A','d','v','e','n','t','u','r','e',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
];

const INSTRUCTIONS_SCREEN: [char; 1000] = [
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ','P',' ','-',' ','t','o',' ','p','l','a','y',' ',' ',' ',' ','I',' ','-',' ','f','o','r',' ','i','n','s','t','r','u','c','t','i','o','n','s',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
' ','T','o',' ','l','o','a','d',' ','a',' ','g','a','m','e',' ','t','y','p','e',' ',' ',' ','L','O','A','D',' ','f','i','l','e','n','a','m','e',' ',' ',' ',' ',
' ','T','o',' ','s','a','v','e',' ','a',' ','g','a','m','e',' ','t','y','p','e',' ',' ',' ','S','A','V','E',' ','f','i','l','e','n','a','m','e',' ',' ',' ',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
' ','o','n','e',' ','h','i','n','t',':','L','o','o','k',' ','a','t',' ','e','v','e','r','y','t','h','i','n','g',' ','c','a','r','e','f','u','l','l','y','!',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
'l','o','o','k',' ','a','t',' ','t','h','e',' ','w','a','l','l',' ','i','n',' ','t','h','e',' ','c','o','u','r','t','y','a','r','d','.',' ',' ',' ',' ',' ',' ',
'1','3',' ','t','r','e','a','s','u','r','e','s','.',' ',' ','T','o',' ',' ','s','e','e',' ','t','h','e',' ','H','i','g','h',' ','s','c','o','r','e',' ',',',' ',
't','w','o',' ','w','o','r','d',' ','c','o','m','m','a','n','d','s','.',' ','T','h','e','r','e',' ','a','r','e',' ','8','3',' ','r','o','o','m','s',' ','&',' ',
'h','a','v','e',' ','a',' ','w','e','a','p','o','n','.','T','h','e',' ','c','o','m','p','u','t','e','r',' ','a','c','c','e','p','t','s',' ','m','o','s','t',' ',
'j','u','s','t',' ',' ','r','u','n',' ',' ','i','n','t','o',' ',' ','t','h','e','m',',',' ',' ','b','u','t',' ','o','n','l','y',' ','i','f',' ','y','o','u',' ',
't','h','e',' ','c','o','m','m','a','n','d',' ',' ','G','E','T','.',' ',' ','T','o',' ',' ','a','t','t','a','c','k',' ',' ','m','o','n','s','t','e','r','s',' ',
'i','t','e','m',' ','n','o','t',' ','d','i','s','p','l','a','y','e','d',' ',' ','o','n',' ',' ','t','h','e',' ','s','c','r','e','e','n',',',' ','u','s','e',' ',
'i','t','e','m',',',' ',' ','j','u','s','t',' ','r','u','n',' ','i','n','t','o',' ','i','t','.',' ',' ','T','o',' ','p','i','c','k',' ','u','p',' ','a','n',' ',
'a','r','o','u','n','d',' ','t','h','e',' ','r','o','o','m','s','.',' ',' ','T','o',' ','p','i','c','k',' ','u','p',' ','a',' ','v','i','s','i','b','l','e',' ',
' ','U','s','e',' ','t','h','e',' ','c','u','r','s','o','r',' ','k','e','y','p','a','d',' ','t','o',' ','m','o','v','e',' ','y','o','u','r',' ','m','a','n',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
'y','o','u',' ','f','i','n','d',' ','t','h','e','m',' ','a','l','l','?',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
't','h','e',' ',' ','c','a','s','t','l','e',' ','i','s',' ',' ','f','u','l','l',' ','o','f',' ',' ','t','r','e','s','u','r','e','s','.',' ',' ','C','a','n',' ',
'a','n','d',' ','y','o','u',' ','m','u','s','t',' ','e','s','c','a','p','e','.',' ','I','t',' ','i','s',' ','r','u','m','o','r','e','d',' ','t','h','a','t',' ',
' ',' ',' ','Y','o','u',' ','a','r','e',' ','t','r','a','p','p','e','d',' ','i','n',' ','a',' ','d','e','s','e','r','t','e','d',' ','C','a','s','t','l','e',' ',
' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',
];

pub fn setup_title_screen(mut terminal: Query<&mut Terminal>) {
    let mut term = terminal.get_single_mut().unwrap();

    term.clear();

    for val in TITLE_SCREEN.iter().enumerate() {
        let glyph = val.1;
        let pos = term.transform_itl(val.0);    
        term.put_char(pos, (*glyph).fg(FORE_COLOR));
    }
}

pub fn title_screen(mut next_state: ResMut<NextState<GameState>>, keycode: Res<ButtonInput<KeyCode>>) {
    if keycode.pressed(KeyCode::KeyP) {
        next_state.set(GameState::InGame);
    }
    if keycode.pressed(KeyCode::KeyI) {
        next_state.set(GameState::InstructionScreen);
    }
}

pub fn cleanup_title_screen(mut terminal: Query<&mut Terminal>) {
    let mut term = terminal.get_single_mut().unwrap();

    term.clear();
}

pub fn setup_instruction_screen(mut terminal: Query<&mut Terminal>) {
    let mut term = terminal.get_single_mut().unwrap();

    term.clear();

    for val in INSTRUCTIONS_SCREEN.iter().enumerate() {
        let glyph = val.1;
        let pos = term.transform_itl(val.0);    
        term.put_char(pos, (*glyph).fg(FORE_COLOR));
    }

}

pub fn instruction_screen(mut next_state: ResMut<NextState<GameState>>, keycode: Res<ButtonInput<KeyCode>>) {
    if keycode.pressed(KeyCode::KeyP) {
        next_state.set(GameState::InGame);
    }
    if keycode.pressed(KeyCode::KeyI) {
        next_state.set(GameState::InstructionScreen);
    }
}

pub fn cleanup_instruction_screen(mut terminal: Query<&mut Terminal>) {
    let mut term = terminal.get_single_mut().unwrap();

    term.clear();
}

